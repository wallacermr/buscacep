<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Busca Cep</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-resource.js"></script>
    <style>
        .header {
            border: 0 solid #000000;
            margin: 0.3125em 0.3125em 0.3125em 0.3125em;
            background-color: #66ffc2;
            height: 40px;
            opacity: 0.5;
        }

        #botoes {
            margin-top: 1em;
            margin-bottom: 1em;
        }
    </style>
</head>
<body>
<div class="header"></div>
<div ng-app="myApp" ng-controller="myCtrl">
    <div class="container">
        <h1 class="text-center">Busca Cep</h1>
        <div class="row">
            <div class="form-group">
                <label for="cepInput">CEP:</label>
                <br />
                <div class="col-md-2" style="padding-left: 0;">
                    <input type="text" class="form-control"
                           id="cepInput" ng-model="filter.cep" maxlength="25" placeholder="Ex: 99999999"
                           ng-disabled="filter.forgotCep" />
                    <small id="hintCep" class="form-text text-muted">
                        Informe somente n√∫meros.
                    </small>
                </div>
                <br />
                <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="forgotCep"
                           ng-model="filter.forgotCep" ng-change="limpaFormulario()">
                    <label class="custom-control-label" for="forgotCep">Esqueceu o cep?</label>
                </div>
            </div>
        </div>
        <div class="row" ng-show="filter.forgotCep">
            <div class="form-group">
                <div class="col-xs-2 col-md-2 col-sm-2 col-lg-2" style="padding: 0;">
                    <label for="uf">UF:</label>
                    <select id="uf" ng-model="filter.uf"
                            class="form-control col-xs-3 col-md-3 col-sm-3 col-lg-3">
                        <option value="es">ES</option>
                        <option value="sp">SP</option>
                    </select>
                </div>
                <div class="col-xs-3 col-md-3 col-sm-3 col-lg-3">
                    <label for="cidade">Cidade:</label>
                    <input type="text" id="cidade" class="form-control"
                           maxlength="100" ng-model="filter.cidade">
                </div>
                <div class="col-xs-4 col-md-4 col-sm-4 col-lg-4">
                    <label for="logradouro">Logradouro:</label>
                    <input type="text" id="logradouro" class="form-control"
                           maxlength="200" ng-model="filter.logradouro">
                </div>
            </div>
        </div>
        <div id="botoes" class="row">
            <div>
                <button class="btn btn-default" ng-click="buscaPorFiltros()" ng-disabled="showBtn">Buscar</button>
                <button class="btn btn-default" ng-click="limpar()">Limpar</button>
            </div>
        </div>
        <div class="row">
            <table class="table table-responsive">
                <thead>
                    <tr>
                        <th>cep</th>
                        <th>logradouro</th>
                        <th>complemento</th>
                        <th>bairro</th>
                        <th>localidade</th>
                        <th>uf</th>
                        <th>ibge</th>
                        <th>gia</th>
                        <th>ddd</th>
                        <th>siafi</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="obj in lista track by $index">
                        <td>{{obj.cep}}</td>
                        <td>{{obj.logradouro}}</td>
                        <td>{{obj.complemento}}</td>
                        <td>{{obj.bairro}}</td>
                        <td>{{obj.localidade}}</td>
                        <td>{{obj.uf}}</td>
                        <td>{{obj.ibge}}</td>
                        <td>{{obj.gia}}</td>
                        <td>{{obj.ddd}}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    var myApp = angular.module('myApp', ['ngResource']);

    myApp.controller('myCtrl', ['$scope', 'MyAppFactory', function($scope, MyAppFactory){
        $scope.showBtn = false;

        $scope.filter = {
            cep: null,
            forgotCep: false,
            uf: null,
            cidade: null,
            logradouro: null
        }

        $scope.limpaFormulario = function() {
            if($scope.filter.forgotCep === true) {
                $scope.filter.cep = null;
            }
            if($scope.filter.forgotCep === false) {
                $scope.filter.uf = null;
                $scope.filter.cidade = null;
                $scope.filter.logradouro = null;
            }
        }

            //TODO implementar o disable do botao buscar paenas quando o cep for igual a 8 carac ou
            //uf for diferente de null e cidade e loggradouro forem maiores do que 3 carac
			//if($scope.filter.cep === 8) {-->
			//    $scope.showBtn = true;-->
			//} else if($scope.filter.cep === null && $scope.filter.uf)-->

        $scope.buscaPorFiltros = function() {
            var cep = $scope.filter.cep;
            if($scope.filter.forgotCep) {
                var uf = $scope.filter.uf;
                var cidade = $scope.filter.cidade;
                var logradouro = $scope.filter.logradouro;
                MyAppFactory.obtemCeps.get({uf: uf, cidade: cidade, logradouro: logradouro})
                    .$promise.then(function(data) {
                    $scope.lista = data;
                });
            } else {
                MyAppFactory.obtemCep.get({cep: $scope.filter.cep})
                    .$promise.then(function(data) {
                    $scope.lista = data;
                });
            }
        };

        $scope.limpar = function() {
            $scope.info = null;
            if($scope.filter.forgotCep) {
                $scope.filter.uf = null;
                $scope.filter.cidade = null;
                $scope.filter.logradouro = null;
            }
        };
    }]);

    myApp.factory('MyAppFactory', ['$resource', function($resource) {
        return {
            obtemCep: $resource('/apirest/teste/:verb/:cep', {}, {
                get: {
                    method: 'GET',
                    params: {verb: 'cep'},
                    isArray: true
                }
            }),
            obtemCeps: $resource('/apirest/teste/:verb/:cep/:uf/:cidade/:logradouro', {}, {
                get: {
                    method: 'GET',
                    params: {verb: 'cep'},
                    isArray: true
                }
            })
        }
    }]);

    myApp.config(['$resourceProvider', function($resourceProvider) {
        $resourceProvider.defaults.stripTrailingSlashes = false;
    }]);
</script>
</body>
</html>